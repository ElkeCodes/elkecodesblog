---
import Tags from "@components/Tags.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { getPublishedPosts } from "@utils/get-published-posts";
import { createOpenGraph } from "@utils/create-open-graph";

type Post = Awaited<ReturnType<typeof getPublishedPosts>>[number];
type TagsMap = Record<string, number>;

const posts: Array<Post> = await getPublishedPosts();
const tags: TagsMap = posts
  .map((post) => post.data.tags)
  .flat()
  .reduce(
    (acc, tag) => {
      if (acc[tag]) {
        acc[tag]++;
      } else {
        acc[tag] = 1;
      }
      return acc;
    },
    {} as TagsMap
  );
const pageTitle: string = "Tag Index";
const description: string = "Browse all blog posts by tag.";
const openGraph = createOpenGraph(pageTitle, "/tags");
---

<BaseLayout pageTitle={pageTitle} description={description} openGraph={openGraph}>
  <Tags tags={tags} />
</BaseLayout>
